<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>stm32plus: stm32plus::net::ArpCache Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">stm32plus
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="namespacestm32plus.html">stm32plus</a>      </li>
      <li class="navelem"><b>net</b>      </li>
      <li class="navelem"><a class="el" href="classstm32plus_1_1net_1_1ArpCache.html">ArpCache</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">stm32plus::net::ArpCache Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="stm32plus::net::ArpCache" -->
<p><code>#include &lt;<a class="el" href="ArpCache_8h_source.html">ArpCache.h</a>&gt;</code></p>

<p><a href="classstm32plus_1_1net_1_1ArpCache-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><b>CacheEntry</b></td></tr>
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classstm32plus_1_1net_1_1ArpCache.html#a31e02c9eb82d3c44b835ef58a374cabc">initialise</a> (uint8_t numEntries, uint32_t expirySeconds, <a class="el" href="classstm32plus_1_1RtcBase.html">RtcBase</a> *rtc)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classstm32plus_1_1net_1_1ArpCache.html#acf3b3d61818324b358a84010a6a882d3">insert</a> (const <a class="el" href="structstm32plus_1_1net_1_1MacAddress.html">MacAddress</a> &amp;mac, const <a class="el" href="structstm32plus_1_1net_1_1IpAddress.html">IpAddress</a> &amp;ip)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classstm32plus_1_1net_1_1ArpCache.html#a64416cad8996e7a96857b67e6e7d0b57">findMacAddress</a> (const <a class="el" href="structstm32plus_1_1net_1_1IpAddress.html">IpAddress</a> &amp;ip, <a class="el" href="structstm32plus_1_1net_1_1MacAddress.html">MacAddress</a> &amp;found)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classstm32plus_1_1net_1_1ArpCache.html#ae526fb1926c1f6be27d1d4fc68d7ee38">setWatchIp</a> (const <a class="el" href="structstm32plus_1_1net_1_1IpAddress.html">IpAddress</a> &amp;ip, <a class="el" href="structstm32plus_1_1net_1_1MacAddress.html">MacAddress</a> *foundMac)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classstm32plus_1_1net_1_1ArpCache.html#a77f6aca1f14e4ab3188df891deb00134">waitForWatch</a> (uint32_t timeout)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Simple LRU cache for an ARP mapping of IP address to MAC address. Implemented as a compact doubly linked list with a fixed maximum number of entries. The list entry overhead is just 2 bytes and no dynamic memory allocation is required after initialisation. Searching is a linear operation from the MRU to the LRU so the number of entries should be kept low. The maximum number of entries is 255. Index #255 is reserved. </p>
</div><hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a64416cad8996e7a96857b67e6e7d0b57"></a><!-- doxytag: member="stm32plus::net::ArpCache::findMacAddress" ref="a64416cad8996e7a96857b67e6e7d0b57" args="(const IpAddress &amp;ip, MacAddress &amp;found)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classstm32plus_1_1net_1_1ArpCache.html#a64416cad8996e7a96857b67e6e7d0b57">stm32plus::net::ArpCache::findMacAddress</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structstm32plus_1_1net_1_1IpAddress.html">IpAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>ip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structstm32plus_1_1net_1_1MacAddress.html">MacAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>found</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Find the MAC address given an IP address. The cached address must not have expired. Expired entries are intentionally not cleaned here to keep the performance to a maximum. Expired entries are detected and recycled in the <a class="el" href="classstm32plus_1_1net_1_1ArpCache.html#acf3b3d61818324b358a84010a6a882d3">insert()</a> method. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">ip</td><td>The IP address to find </td></tr>
    <tr><td class="paramname">found</td><td>The found mac address </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>true if found </dd></dl>

</div>
</div>
<a class="anchor" id="a31e02c9eb82d3c44b835ef58a374cabc"></a><!-- doxytag: member="stm32plus::net::ArpCache::initialise" ref="a31e02c9eb82d3c44b835ef58a374cabc" args="(uint8_t numEntries, uint32_t expirySeconds, RtcBase *rtc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classstm32plus_1_1net_1_1ArpCache.html#a31e02c9eb82d3c44b835ef58a374cabc">stm32plus::net::ArpCache::initialise</a> </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>numEntries</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>expirySeconds</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classstm32plus_1_1RtcBase.html">RtcBase</a> *&#160;</td>
          <td class="paramname"><em>rtc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Initialise the cache. Memory is created for the array of entries up front to avoid churn of the heap that may occur during activity if entries were dynamically allocated. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">numEntries</td><td>The maximum number of entries </td></tr>
    <tr><td class="paramname">expirySeconds</td><td>Max time to keep an entry in the cache. An entry will still be evicted if it's the LRU and a new entry comes in to a full cache. </td></tr>
    <tr><td class="paramname">rtc</td><td>A pointer to the RTC used to get the current time </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>true if it works </dd></dl>

</div>
</div>
<a class="anchor" id="acf3b3d61818324b358a84010a6a882d3"></a><!-- doxytag: member="stm32plus::net::ArpCache::insert" ref="acf3b3d61818324b358a84010a6a882d3" args="(const MacAddress &amp;mac, const IpAddress &amp;ip)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classstm32plus_1_1net_1_1ArpCache.html#acf3b3d61818324b358a84010a6a882d3">stm32plus::net::ArpCache::insert</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structstm32plus_1_1net_1_1MacAddress.html">MacAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>mac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structstm32plus_1_1net_1_1IpAddress.html">IpAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>ip</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Insert a new entry or update an old one. This is IRQ-safe </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">mac</td><td>The MAC address to insert </td></tr>
    <tr><td class="paramname">ip</td><td>The associated IP address </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ae526fb1926c1f6be27d1d4fc68d7ee38"></a><!-- doxytag: member="stm32plus::net::ArpCache::setWatchIp" ref="ae526fb1926c1f6be27d1d4fc68d7ee38" args="(const IpAddress &amp;ip, MacAddress *foundMac)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classstm32plus_1_1net_1_1ArpCache.html#ae526fb1926c1f6be27d1d4fc68d7ee38">stm32plus::net::ArpCache::setWatchIp</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structstm32plus_1_1net_1_1IpAddress.html">IpAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>ip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structstm32plus_1_1net_1_1MacAddress.html">MacAddress</a> *&#160;</td>
          <td class="paramname"><em>foundMac</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Set a watch IP address (will be triggered when inserted) </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">ip</td><td>The IP address to watch for </td></tr>
    <tr><td class="paramname">foundMac</td><td>Where to store the found MAC result </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a77f6aca1f14e4ab3188df891deb00134"></a><!-- doxytag: member="stm32plus::net::ArpCache::waitForWatch" ref="a77f6aca1f14e4ab3188df891deb00134" args="(uint32_t timeout)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classstm32plus_1_1net_1_1ArpCache.html#a77f6aca1f14e4ab3188df891deb00134">stm32plus::net::ArpCache::waitForWatch</a> </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>timeout</em></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Wait for a configurable time for a watch ip to be triggered. The idea is that an ARP frame is received over an IRQ and added to the cache, releasing the main CPU that is waiting on the watch flag. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">timeout</td><td>The timeout value in ms </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>true if found in time </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>include/net/network/arp/<a class="el" href="ArpCache_8h_source.html">ArpCache.h</a></li>
</ul>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Tue May 27 2014 07:25:44 for stm32plus by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
